# Lab3

## [练习0] 填写已有实验

> 已完成

## [练习1] 给未被映射的地址映射上物理页

[练习1.1] 请描述页目录项（Pag Director Entry）和页表（Page Table Entry）中组成部分对ucore实现页替换算法的潜在用处。

> 

[练习1.2] 如果ucore的缺页服务例程在执行过程中访问内存，出现了页访问异常，请问硬件要做哪些事情？

> 

## [练习2] 补充完成基于FIFO的页面替换算法

[练习2.1] 如果要在ucore上实现"extended clock页替换算法"请给你的设计方案，现有的swap_manager框架是否足以支持在ucore中实现此算法？如果是，请给你的设计方案。如果不是，请给出你的新的扩展和基此扩展的设计方案。并需要回答如下问题

- 需要被换出的页的特征是什么？
- 在ucore中如何判断具有这样特征的页？
- 何时进行换入和换出操作？

> 

## 与参考答案的区别：

> 参考答案[`kern/mm/swap_fifo.c`](../../labcodes_answer/lab3_result/kern/mm/swap_fifo.c)的`_fifo_swap_out_victim`函数里有一句`list_entry_t *le = head->prev;`是错误的。因为在前面的章节中，老师已经强调过，为了适应不同的硬件实现，特意将链表与数据分离。因此，这里不能假定获取head的前一个元素的方法是`head->prev`，而应该使用我的写法`list_entry_t *le = list_prev(head);`，调用[list.h](libs/list.h)中提供的方法。否则，当链表实现与`head->prev`这种写法不兼容时会出严重错误。

## 重要的知识点

> FIFO PRA。

> 对应知识点：局部页面替换FIFO算法。

> 含义：当需要有页面换出时，换出最先换入的页。

> 关系：本质上是同一个算法。

> 差异：OS原理中，页面换入和换出是同时进行的，是一个操作，有事务性（页面满时，换入一个页面一定会换出一个页面，保证页面总量不变）；实验中，页面换入是在`_fifo_map_swappable`中实现的，换出是在`_fifo_swap_out_victim`中实现的，是两个操作，FIFO算法代码本身不能保证两个操作的事务性，要由调用者来保证事务性。
